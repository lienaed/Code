<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Physics-Based Movement</title>
        <style>
            body 
            {
                margin: 0;
                overflow: hidden;
                background-color: #ddd;
            }
            canvas 
            {
                display: block;
            }
        </style>
    </head>

    <body>
        <canvas id="Board"></canvas>

        <input type = "radio" name = "Modes" id = "flat" checked>
        <label for = "flat">Flat</label>
        <input type = "radio" name = "Modes" id = "gravity">
        <label for = "gravity">Gravity</label>

        <style>
            input[type="radio"] 
            {
                display: none; /* 隐藏 radio 按钮 */
            }
            label {
                display: inline-block;
                width: 100px;
                height: 50px;
                line-height: 50px;
                text-align: center;
                margin: 5px;
                border: 2px solid black;
                cursor: pointer;
                background-color: lightgray;
            }
            input[type="radio"]:checked + label {
                background-color: yellow; /* 选中时变黄色 */
            }
        </style>


        <script>
            function game()
            {
                const board = document.getElementById ("Board");
                board.width = window.innerWidth;
                board.height = window.innerHeight;
                const maxVelocity = 30;
                const acceleration = 0.4;
                const friction = 0.99;
                const staticFriction = 0.2;
                const bounceForce = 1;

                const box = 
                {
                    width: 100,
                    height: 100,
                    x: board.width / 2 - 50,
                    y: board.height / 2 - 50,
                    vx: 0,
                    vy: 0,
                    image: new Image()
                }
                box.image.src = "https://lienaed.github.io/Code/Images/black.jpg";

                const keys = {};
                document.addEventListener ("keydown", (event) => keys [event.key] = 1);
                document.addEventListener ("keyup", (event) => keys [event.key] = 0);

                function flat ()
                {
                                        if (keys ["w"] || keys[" "])
                        box.vy -= acceleration;
                    if (keys ["s"])
                        box.vy += acceleration;
                    if (keys ["a"])
                        box.vx -= acceleration;
                    if (keys ["d"])
                        box.vx += acceleration;
                    
                    box.vx = Math.max (-maxVelocity, Math.min (maxVelocity, box.vx));
                    box.vy = Math.max (-maxVelocity, Math.min (maxVelocity, box.vy));
                    
                    box.vx *= friction;
                    box.vy *= friction;

                    if (Math.sqrt ((Math.abs (box.vx))**2 + (Math.abs (box.vy))**2) < staticFriction)
                    {
                        box.vx = 0;
                        box.vy = 0;
                    }

                    if (box.x <= 0 || box.x >= board.width - box.width)
                        box.vx = -box.vx * bounceForce;
                    if (box.y <= 0 || box.y >= board.height - box.height)
                        box.vy = -box.vy * bounceForce;
                }
                function movement ()
                {
                    box.x += box.vx;
                    box.y += box.vy;
                        
                    if (box.x <= 0) 
                    {
                        box.x = 0;      
                    }
                    if (box.x >= board.width - box.width) 
                    {
                        box.x = board.width - box.width;
                    }
                    if (box.y <= 0) 
                    {
                        box.y = 0;
                    }
                    if (box.y >= board.height - box.height) 
                    {
                        box.y = board.height - box.height;
                    }

                }

                const draw = board.getContext ("2d");
                function paint ()
                {
                    draw.clearRect (0, 0, board.width, board.height);
                    draw.drawImage (box.image, box.x, box.y, box.width, box.height);
                }
                function loop ()
                {
                    flat();
                    movement();
                    paint();
                    requestAnimationFrame (loop);
                }
                box.image.onload = () => 
                {
                    loop();
                }

            }
            game();
        </script>
    </body>

</html>